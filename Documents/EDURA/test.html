<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Games by Standard</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
  <style>
    .card { margin: 10px; }
    .game-card {
        display: flex;
        flex-direction: column;
        background-color: white;
        border-radius: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transition: all 0.2s ease;
        max-width: 24rem;
      }
      
      .game-card:hover {
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      
      .game-card-content {
        padding: 2rem 1.5rem;
      }
      
      .game-image-container {
        position: relative;
        width: 100%;
        aspect-ratio: 16/9;
        border-radius: 0.75rem;
        overflow: hidden;
        margin-bottom: 1.5rem;
      }
      
      .game-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      
      .game-category {
        font-size: 1.875rem;
        font-weight: 500;
        letter-spacing: -0.025em;
        color: #4B5563;
        margin-bottom: 0.5rem;
      }
      
      .button-container {
        padding: 0 1.5rem 2rem 1.5rem;
      }
      
      .view-details-button {
        display: inline-flex;
        width: 100%;
        justify-content: center;
        align-items: center;
        padding: 0.625rem 1.5rem;
        background-color: black;
        color: white;
        border: 2px solid black;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.2s ease;
      }
      
      .view-details-button:hover {
        background-color: transparent;
        color: black;
      }
      
      .view-details-button:focus {
        outline: none;
        ring: 2px;
        ring-color: black;
      }
  </style>
</head>
<body>
  <div class="container my-4">
    <h1 class="mb-4">Games by Standard</h1>

    <!-- Input for standard -->
    <div class="form-group">
      <label for="standardInput">Enter your Standard:</label>
      <input type="number" id="standardInput" class="form-control" placeholder="E.g. 5" />
    </div>
    <button id="getGamesBtn" class="btn btn-primary mb-4">Get Games</button>

    <!-- Container to display games grouped by fixed categories -->
    <div id="gamesContainer"></div>
  </div>

  <!-- Modal for game details -->
  <div class="modal fade" id="gameModal" tabindex="-1" role="dialog" aria-labelledby="gameModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="gameModalLabel" class="modal-title">Game Details</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <img id="modalGameImage" src="" alt="Game Image" class="img-fluid mb-3" />
          <p id="modalGameText"></p>
        </div>
        <div class="modal-footer">
          <button id="playNowBtn" type="button" class="btn btn-success">Play Now</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery and Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Custom JavaScript -->
  <script>
    // Fixed categories in the application.
    const categories = ['Math', 'GK', 'Reasoning', 'Reading'];
    // Set baseUrl to your API host's IP address and port.
    const baseUrl = 'http://192.168.137.97:8080';

    document.getElementById('getGamesBtn').addEventListener('click', () => {
      const standard = document.getElementById('standardInput').value;
      if (!standard) {
        alert("Please enter a standard.");
        return;
      }
      // Clear previous results.
      document.getElementById('gamesContainer').innerHTML = '';

      // For each fixed category, fetch games and display them.
      categories.forEach(category => {
        // Create a section for this category.
        const categorySection = document.createElement('div');
        categorySection.className = 'mb-4';
        categorySection.innerHTML = <h2>${category}</h2>;
        const row = document.createElement('div');
        row.className = 'row';

        // Build the API URL for this category.
        const apiUrl = ${baseUrl}/games/standard/${standard}/category/${category};
        console.log("Fetching:", apiUrl);

        fetch(apiUrl)
          .then(response => {
            if (!response.ok) {
              throw new Error(HTTP error! status: ${response.status});
            }
            return response.json();
          })
          .then(data => {
            console.log("Data for", category, data);
            if (data.length === 0) {
              const noData = document.createElement('p');
              noData.textContent = 'No games available.';
              row.appendChild(noData);
            } else {
              data.forEach(game => {
                const col = document.createElement('div');
                col.className = 'col-md-3';
                // Create a card for the game.
                col.innerHTML = `
                  <div class="game-card">
  <div class="game-card-content">
    <div class="game-image-container">
      <img src="${game.imageUrl}" alt="${game.category}" 
           onerror="this.src='https://via.placeholder.com/150?text=Game+Image';"
           class="game-image">
    </div>
    <h3 class="game-category">${game.category}</h3>
  </div>
  <div class="button-container">
    <button class="view-details-button" onclick='handleViewDetails(${JSON.stringify(game)})'>
      View Details
    </button>
  </div>
</div>
                `;
                row.appendChild(col);
              });
            }
          })
          .catch(error => {
            console.error('Error fetching games for category:', category, error);
            const errorMsg = document.createElement('p');
            errorMsg.textContent = Error fetching ${category} games.;
            row.appendChild(errorMsg);
          });

        categorySection.appendChild(row);
        document.getElementById('gamesContainer').appendChild(categorySection);
      });
    });

    // Event delegation for dynamically created "View Details" buttons.
    document.getElementById('gamesContainer').addEventListener('click', function(e) {
      if (e.target && e.target.classList.contains('view-game-btn')) {
        const game = JSON.parse(e.target.getAttribute('data-game'));
        // Populate modal with game details.
        document.getElementById('gameModalLabel').textContent = ${game.category} - ${game.gameUrl};
        document.getElementById('modalGameImage').src = game.imageUrl;
        document.getElementById('modalGameText').textContent = game.text;
        document.getElementById('playNowBtn').onclick = function() {
          // For demonstration: alert the game URL.
          alert('Playing: ' + game.gameUrl);
        };
        // Show the modal.
        $('#gameModal').modal('show');
      }
    });
  </script>
</body>
</html>